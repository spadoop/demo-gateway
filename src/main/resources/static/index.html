<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>OCS商城</title>
<link rel="stylesheet" href="bootstrap/css/bootstrap.min.css"/>
<link rel="stylesheet" href="bootstrap/table/bootstrap-table.min.css"/>
<script type="text/javascript" src="js/jquery-3.1.1.min.js"></script>
<script type="text/javascript" src="bootstrap/js/bootstrap.js"></script>
<script type="text/javascript" src="bootstrap/table/bootstrap-table.min.js"></script>
<script type="text/javascript">
var is_login = false;
$(document).ready(function(){
	//用户信息
	$.ajax({
		url:'/passport/getuser',
		async: false,
		success:function(result){
			if(result.code==200){
				$('#userName').html(result.data.displayname);
				is_login = true;
			}
		},
		error:function(XMLHttpRequest, textStatus, errorThrown){
			if(XMLHttpRequest.status == 400){
				$('#userName').html('未登录');
				$('.btn-group .dropdown-menu').hide();
			}
		}
	});
	$('#logout').click(function(){
		$.ajax({
			url:'/passport/logout',
			success:function(result){
				window.location.href = '/login.html';
			}
		});
	});
	$('table').bootstrapTable({
		url:'/product/list',
		dataField: "data",
		pageList: [5, 10, 20, 50],
		dataType: "json",
		columns: [
            {
                title: "商品名称",//标题
                field: "proName"//键名
                //sortable: true,//是否可排序
                //order: "desc"//默认排序方式
            },
            {
                field: "amount",
                title: "商品数量",
                sortable: true
                //titleTooltip: "this is name"
            },
            {
                field: "price",
                title: "商品价格",
                sortable: true
            },
            {
                field: "id",
                title: "操作",
                formatter: 'infoFormatter',//对本列数据做格式化
            }
        ],
        locale: "zh-CN",
        responseHandler:function(res){
        	if(res.code==200)
        		return res;
        	else
        		return null;
        }
	});
});

function infoFormatter(value, row, index){
	if(is_login)
    	return '<span class="btn btn-primary btn-xs" onclick="buy(\'' + value + '\')">购买</span>';
    else
    	return '<a href="/login.html">请先登录</a>';
}

function buy(pid){
	$.ajax({
		url:'/order/neworder',
		data:{"productId":pid},
		dataType:'json',
		method:'post',
		success:function(result){
			if(result.code==200){
				window.location.href = "/order.html";
			}
		}
	});
}
</script>
</head>
<body>
<nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <div class="navbar-header col-md-10">
      <a class="navbar-brand" href="#">
        OCS商城
      </a>
    </div>
    
	    <!-- Single button -->
		<div class="btn-group col-md-2" style="padding-top:8px;">
		  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    <span id="userName">Action</span> <span class="caret"></span>
		  </button>
		  <ul class="dropdown-menu">
		    <li><a href="javascript:void(0);" id="logout">退出</a></li>
		  </ul>
		</div>
  </div>
</nav>
<div style="padding:2px">
<div class="panel panel-primary">
	<div class="panel-heading">商品列表</div>
	<div class="panel-body">
		<div>
			<table class="table">
				<thead>
					<tr>
						<th>商品名称</th>
						<th>商品数量</th>
						<th>商品价格</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody>
					<!-- <tr>
						<td>Iphone 7</td>
						<td>1000</td>
						<td>7000.00</td>
						<td><span class="btn btn-primary btn-xs">购买</span></td>
					</tr>
					<tr>
						<td>Iphone 6</td>
						<td>1000</td>
						<td>6000.00</td>
						<td><span class="btn btn-primary btn-xs">购买</span></td>
					</tr>
					<tr>
						<td>Iphone 5</td>
						<td>1000</td>
						<td>5000.00</td>
						<td><span class="btn btn-primary btn-xs">购买</span></td>
					</tr>
					<tr>
						<td>Iphone 4</td>
						<td>1000</td>
						<td>4000.00</td>
						<td><span class="btn btn-primary btn-xs">购买</span></td>
					</tr>
					<tr>
						<td>Iphone 3</td>
						<td>1000</td>
						<td>3000.00</td>
						<td><span class="btn btn-primary btn-xs">购买</span></td>
					</tr> -->
				</tbody>
			</table>
		</div>
	</div>
</div>
</div>

</body>
</html>